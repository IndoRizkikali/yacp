--- origsrc/cnats-1.8.0/CMakeLists.txt	2018-10-18 02:20:45.000000000 +0900
+++ src/cnats-1.8.0/CMakeLists.txt	2019-03-29 08:04:29.438050200 +0900
@@ -76,6 +76,11 @@ if(UNIX)
     if(NATS_BUILD_STREAMING)
       set(NATS_PROTOBUF_LIB "${PROTOBUF_DIR}/lib/darwin/libprotobuf-c.a")
     endif(NATS_BUILD_STREAMING)
+  elseif(CYGWIN)
+    set(NATS_OS "CYGWIN")
+    if(NATS_BUILD_STREAMING)
+      set(NATS_PROTOBUF_LIB "protobuf-c")
+    endif(NATS_BUILD_STREAMING)
   else(APPLE)
     set(NATS_OS "LINUX")
     set(NATS_USE_PTHREAD "-pthread")
@@ -165,3 +170,9 @@ add_subdirectory(test)
 add_subdirectory(test/dylib)
 #----------------------------
 
+SET(prefix ${CMAKE_INSTALL_PREFIX})
+SET(exec_prefix ${CMAKE_INSTALL_PREFIX})
+SET(libdir ${CMAKE_INSTALL_PREFIX}/lib)
+SET(includedir ${CMAKE_INSTALL_PREFIX}/include)
+CONFIGURE_FILE(${CMAKE_SOURCE_DIR}/cnats.pc.in ${CMAKE_BINARY_DIR}/cnats.pc @ONLY)
+INSTALL(FILES ${CMAKE_BINARY_DIR}/cnats.pc DESTINATION ${CMAKE_INSTALL_PREFIX}/lib/pkgconfig)
--- origsrc/cnats-1.8.0/cnats.pc.in	1970-01-01 09:00:00.000000000 +0900
+++ src/cnats-1.8.0/cnats.pc.in	2019-03-29 08:05:15.818012000 +0900
@@ -0,0 +1,10 @@
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+includedir=@includedir@
+
+Name: cnats
+Description: C client for NATS
+Version: @NATS_VERSION_MAJOR@.@NATS_VERSION_MINOR@.@NATS_VERSION_PATCH@
+Libs: -L${libdir} -lnats
+Cflags: -I${includedir}
--- origsrc/cnats-1.8.0/src/CMakeLists.txt	2018-10-18 02:20:45.000000000 +0900
+++ src/cnats-1.8.0/src/CMakeLists.txt	2019-03-29 07:49:01.476773500 +0900
@@ -31,17 +31,24 @@ endif(NATS_BUILD_STREAMING)
 # --------------------------------------
 add_library(nats SHARED ${SOURCES} ${PS_SOURCES} ${S_SOURCES})
 target_link_libraries(nats ${NATS_OPENSSL_LIBS} ${NATS_EXTRA_LIB} ${NATS_PROTOBUF_LIB})
-add_library(nats_static STATIC ${SOURCES} ${PS_SOURCES} ${S_SOURCES})
-target_link_libraries(nats_static ${NATS_OPENSSL_LIBS} ${NATS_PROTOBUF_LIB})
-set_target_properties(nats nats_static PROPERTIES
+set_target_properties(nats PROPERTIES
   VERSION ${NATS_VERSION_MAJOR}.${NATS_VERSION_MINOR}.${NATS_VERSION_PATCH}
   SOVERSION ${NATS_VERSION_MAJOR}.${NATS_VERSION_MINOR})
+if (NOT BUILD_SHARED_LIBS)
+  add_library(nats_static STATIC ${SOURCES} ${PS_SOURCES} ${S_SOURCES})
+  target_link_libraries(nats_static ${NATS_OPENSSL_LIBS} ${NATS_PROTOBUF_LIB})
+  set_target_properties(nats_static PROPERTIES
+    VERSION ${NATS_VERSION_MAJOR}.${NATS_VERSION_MINOR}.${NATS_VERSION_PATCH}
+    SOVERSION ${NATS_VERSION_MAJOR}.${NATS_VERSION_MINOR})
+endif()
 
 # --------------------------------------
 # Install the libraries and header files
 # --------------------------------------
-install(TARGETS nats DESTINATION ${NATS_LIBDIR})
-install(TARGETS nats_static ARCHIVE DESTINATION ${NATS_LIBDIR})
+install(TARGETS nats RUNTIME DESTINATION bin ARCHIVE DESTINATION ${NATS_LIBDIR})
+if (NOT BUILD_SHARED_LIBS)
+  install(TARGETS nats_static ARCHIVE DESTINATION ${NATS_LIBDIR})
+endif()
 install(FILES deprnats.h DESTINATION ${NATS_INCLUDE_DIR} RENAME nats.h)
 install(FILES nats.h status.h version.h DESTINATION ${NATS_INCLUDE_DIR}/nats)
 install(FILES adapters/libevent.h adapters/libuv.h DESTINATION ${NATS_INCLUDE_DIR}/nats/adapters)
--- origsrc/cnats-1.8.0/test/CMakeLists.txt	2018-10-18 02:20:45.000000000 +0900
+++ src/cnats-1.8.0/test/CMakeLists.txt	2019-03-29 07:50:01.468722000 +0900
@@ -16,7 +16,7 @@ endif(NATS_BUILD_STREAMING)
 add_executable(testsuite test.c)
 
 # Link statically with the library
-target_link_libraries(testsuite nats_static ${NATS_EXTRA_LIB})
+target_link_libraries(testsuite nats ${NATS_EXTRA_LIB})
 
 # Set the test index to 0
 set(testIndex 0)
