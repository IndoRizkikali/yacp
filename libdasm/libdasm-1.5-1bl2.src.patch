diff -buprN -x CYGWIN-PATCHES -x aclocal.m4~ -x aclocal.m4t -x autom4te.cache -x config.cache -x config.guess -x config.log -x config.status -x config.sub -x '*SlackBuild*' -x '*.egg-info' -x '*.dll' -x '*.exe' -x '*.o' -x '*.gch' -x '*.gem' -x .gitignore -x '*.jpg' -x '*.png' -x '*.qm' -x '*.svgz' -x '*.tif' -x '*.class' -x '*.jlc' -x '*.pyc' -x '*.pyo' -x '*.mo' -x '*.gmo' -x '*.orig' -x '*.rej' -x '*.spec' -x '*.temp' -x '*~' -x '*.stackdump' -x x86_64-pc-cygwin -x aclocal.m4 -x configure -x config.h -x '*.h.in' -x COPYING -x INSTALL -x ansi2knr.c -x ar-lib -x config-ml.in -x elisp-comp -x mdate-sh -x mkinstalldirs -x py-compile -x symlink-tree -x test-driver -x texinfo.tex -x ylwrap -x Makefile.in -x GNUmakefile.in -x makefile.in -x libtool.m4 -x ltoptions.m4 -x ltsugar.m4 -x ltversion.m4 -x lt~obsolete.m4 -x ltmain.sh -x compile -x depcomp -x install-sh -x missing -x omf.make -x xmldocs.make -x gnome-doc-utils.make -x gnome-doc-utils.m4 -x mate-doc-utils.make -x mate-doc-utils.m4 -x Makefile origsrc/libdasm-1.5/Makefile.am src/libdasm-1.5/Makefile.am
--- origsrc/libdasm-1.5/Makefile.am	1970-01-01 09:00:00.000000000 +0900
+++ src/libdasm-1.5/Makefile.am	2018-04-26 12:50:08.284745000 +0900
@@ -0,0 +1,19 @@
+
+include_HEADERS = libdasm.h
+
+bin_PROGRAMS = das
+das_LDADD = libdasm.la
+das_SOURCES = examples/das.c
+
+lib_LTLIBRARIES = libdasm.la
+libdasm_la_LDFLAGS = -no-undefined
+libdasm_la_SOURCES = libdasm.c
+
+check_PROGRAMS = simple
+simple_LDADD = libdasm.la
+simple_SOURCES = examples/simple.c
+
+TESTS = simple
+
+pkgconfigdir = $(libdir)/pkgconfig
+pkgconfig_DATA = $(PACKAGE).pc
diff -buprN -x CYGWIN-PATCHES -x aclocal.m4~ -x aclocal.m4t -x autom4te.cache -x config.cache -x config.guess -x config.log -x config.status -x config.sub -x '*SlackBuild*' -x '*.egg-info' -x '*.dll' -x '*.exe' -x '*.o' -x '*.gch' -x '*.gem' -x .gitignore -x '*.jpg' -x '*.png' -x '*.qm' -x '*.svgz' -x '*.tif' -x '*.class' -x '*.jlc' -x '*.pyc' -x '*.pyo' -x '*.mo' -x '*.gmo' -x '*.orig' -x '*.rej' -x '*.spec' -x '*.temp' -x '*~' -x '*.stackdump' -x x86_64-pc-cygwin -x aclocal.m4 -x configure -x config.h -x '*.h.in' -x COPYING -x INSTALL -x ansi2knr.c -x ar-lib -x config-ml.in -x elisp-comp -x mdate-sh -x mkinstalldirs -x py-compile -x symlink-tree -x test-driver -x texinfo.tex -x ylwrap -x Makefile.in -x GNUmakefile.in -x makefile.in -x libtool.m4 -x ltoptions.m4 -x ltsugar.m4 -x ltversion.m4 -x lt~obsolete.m4 -x ltmain.sh -x compile -x depcomp -x install-sh -x missing -x omf.make -x xmldocs.make -x gnome-doc-utils.make -x gnome-doc-utils.m4 -x mate-doc-utils.make -x mate-doc-utils.m4 -x Makefile origsrc/libdasm-1.5/configure.ac src/libdasm-1.5/configure.ac
--- origsrc/libdasm-1.5/configure.ac	1970-01-01 09:00:00.000000000 +0900
+++ src/libdasm-1.5/configure.ac	2018-04-26 12:50:08.284745000 +0900
@@ -0,0 +1,33 @@
+#                                               -*- Autoconf -*-
+# Process this file with autoconf to produce a configure script.
+
+AC_PREREQ([2.69])
+AC_INIT([libdasm], [1.5])
+AC_CONFIG_SRCDIR([libdasm.c])
+AC_CONFIG_HEADERS([config.h])
+AM_INIT_AUTOMAKE
+
+# Checks for programs.
+AC_PROG_CC
+AC_PROG_INSTALL
+AC_PROG_MAKE_SET
+LT_INIT
+
+# Checks for libraries.
+
+# Checks for header files.
+AC_CHECK_HEADERS([stdlib.h string.h])
+
+# Checks for typedefs, structures, and compiler characteristics.
+AC_TYPE_INT16_T
+AC_TYPE_INT32_T
+AC_TYPE_INT64_T
+AC_TYPE_INT8_T
+AC_TYPE_SSIZE_T
+
+# Checks for library functions.
+AC_FUNC_MALLOC
+AC_CHECK_FUNCS([memset strncasecmp])
+
+AC_CONFIG_FILES([libdasm.pc Makefile])
+AC_OUTPUT
diff -buprN -x CYGWIN-PATCHES -x aclocal.m4~ -x aclocal.m4t -x autom4te.cache -x config.cache -x config.guess -x config.log -x config.status -x config.sub -x '*SlackBuild*' -x '*.egg-info' -x '*.dll' -x '*.exe' -x '*.o' -x '*.gch' -x '*.gem' -x .gitignore -x '*.jpg' -x '*.png' -x '*.qm' -x '*.svgz' -x '*.tif' -x '*.class' -x '*.jlc' -x '*.pyc' -x '*.pyo' -x '*.mo' -x '*.gmo' -x '*.orig' -x '*.rej' -x '*.spec' -x '*.temp' -x '*~' -x '*.stackdump' -x x86_64-pc-cygwin -x aclocal.m4 -x configure -x config.h -x '*.h.in' -x COPYING -x INSTALL -x ansi2knr.c -x ar-lib -x config-ml.in -x elisp-comp -x mdate-sh -x mkinstalldirs -x py-compile -x symlink-tree -x test-driver -x texinfo.tex -x ylwrap -x Makefile.in -x GNUmakefile.in -x makefile.in -x libtool.m4 -x ltoptions.m4 -x ltsugar.m4 -x ltversion.m4 -x lt~obsolete.m4 -x ltmain.sh -x compile -x depcomp -x install-sh -x missing -x omf.make -x xmldocs.make -x gnome-doc-utils.make -x gnome-doc-utils.m4 -x mate-doc-utils.make -x mate-doc-utils.m4 -x Makefile origsrc/libdasm-1.5/libdasm.pc.in src/libdasm-1.5/libdasm.pc.in
--- origsrc/libdasm-1.5/libdasm.pc.in	1970-01-01 09:00:00.000000000 +0900
+++ src/libdasm-1.5/libdasm.pc.in	2018-04-26 12:50:08.253366600 +0900
@@ -0,0 +1,10 @@
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+includedir=@includedir@
+
+Name: libdasm
+Description: Disassembly library
+Version: @VERSION@
+Libs: -L${libdir} -ldasm
+Cflags: -I${includedir}
diff -buprN -x CYGWIN-PATCHES -x aclocal.m4~ -x aclocal.m4t -x autom4te.cache -x config.cache -x config.guess -x config.log -x config.status -x config.sub -x '*SlackBuild*' -x '*.egg-info' -x '*.dll' -x '*.exe' -x '*.o' -x '*.gch' -x '*.gem' -x .gitignore -x '*.jpg' -x '*.png' -x '*.qm' -x '*.svgz' -x '*.tif' -x '*.class' -x '*.jlc' -x '*.pyc' -x '*.pyo' -x '*.mo' -x '*.gmo' -x '*.orig' -x '*.rej' -x '*.spec' -x '*.temp' -x '*~' -x '*.stackdump' -x x86_64-pc-cygwin -x aclocal.m4 -x configure -x config.h -x '*.h.in' -x COPYING -x INSTALL -x ansi2knr.c -x ar-lib -x config-ml.in -x elisp-comp -x mdate-sh -x mkinstalldirs -x py-compile -x symlink-tree -x test-driver -x texinfo.tex -x ylwrap -x Makefile.in -x GNUmakefile.in -x makefile.in -x libtool.m4 -x ltoptions.m4 -x ltsugar.m4 -x ltversion.m4 -x lt~obsolete.m4 -x ltmain.sh -x compile -x depcomp -x install-sh -x missing -x omf.make -x xmldocs.make -x gnome-doc-utils.make -x gnome-doc-utils.m4 -x mate-doc-utils.make -x mate-doc-utils.m4 -x Makefile origsrc/libdasm-1.5/pydasm/setup.py src/libdasm-1.5/pydasm/setup.py
--- origsrc/libdasm-1.5/pydasm/setup.py	2007-12-27 15:27:53.000000000 +0900
+++ src/libdasm-1.5/pydasm/setup.py	2018-04-26 13:04:03.313000000 +0900
@@ -6,10 +6,10 @@ from distutils.sysconfig import get_pyth
 incdir = os.path.join(get_python_inc(plat_specific=1))
 
 module = Extension('pydasm',
-	include_dirs = [incdir],
-	libraries = [],
-	library_dirs = [],
-	sources = ['../libdasm.c', 'pydasm.c'])
+	include_dirs = [incdir, '..'],
+	libraries = ['dasm'],
+	library_dirs = ['../.libs'],
+	sources = ['pydasm.c'])
 
 setup(name = 'pydasm',
     version = '1.5',
diff -buprN -x CYGWIN-PATCHES -x aclocal.m4~ -x aclocal.m4t -x autom4te.cache -x config.cache -x config.guess -x config.log -x config.status -x config.sub -x '*SlackBuild*' -x '*.egg-info' -x '*.dll' -x '*.exe' -x '*.o' -x '*.gch' -x '*.gem' -x .gitignore -x '*.jpg' -x '*.png' -x '*.qm' -x '*.svgz' -x '*.tif' -x '*.class' -x '*.jlc' -x '*.pyc' -x '*.pyo' -x '*.mo' -x '*.gmo' -x '*.orig' -x '*.rej' -x '*.spec' -x '*.temp' -x '*~' -x '*.stackdump' -x x86_64-pc-cygwin -x aclocal.m4 -x configure -x config.h -x '*.h.in' -x COPYING -x INSTALL -x ansi2knr.c -x ar-lib -x config-ml.in -x elisp-comp -x mdate-sh -x mkinstalldirs -x py-compile -x symlink-tree -x test-driver -x texinfo.tex -x ylwrap -x Makefile.in -x GNUmakefile.in -x makefile.in -x libtool.m4 -x ltoptions.m4 -x ltsugar.m4 -x ltversion.m4 -x lt~obsolete.m4 -x ltmain.sh -x compile -x depcomp -x install-sh -x missing -x omf.make -x xmldocs.make -x gnome-doc-utils.make -x gnome-doc-utils.m4 -x mate-doc-utils.make -x mate-doc-utils.m4 -x Makefile origsrc/libdasm-1.5/rbdasm/dasm.c src/libdasm-1.5/rbdasm/dasm.c
--- origsrc/libdasm-1.5/rbdasm/dasm.c	2006-01-11 14:19:41.000000000 +0900
+++ src/libdasm-1.5/rbdasm/dasm.c	2018-04-26 12:25:53.103000000 +0900
@@ -611,14 +611,14 @@ static VALUE dasm_disassemble(VALUE self
 	int          use_block = rb_block_given_p();
 
 	buf = StringValue(buf);
-	len = RSTRING(buf)->len;
+	len = RSTRING_LEN(buf);
 	
 	rb_dasm_cast(self, obj);
 
 	while (offset < len)
 	{
 		VALUE	rb_inst;
-		BYTE  *current = (BYTE *)(RSTRING(buf)->ptr + offset);
+		BYTE  *current = (BYTE *)(RSTRING_PTR(buf) + offset);
 
 		if (!get_instruction(&inst, current, obj->mode))
 			break;
@@ -652,7 +652,7 @@ static VALUE dasm_disassemble_one(VALUE
 	BYTE         *current;
 
 	buf     = StringValue(buf);
-	current = (BYTE *)RSTRING(buf)->ptr;
+	current = (BYTE *)RSTRING_PTR(buf);
 
 	rb_dasm_cast(self, obj);
 	
@@ -716,9 +716,9 @@ static VALUE dasm_set_format(VALUE self,
 
 	rb_dasm_cast(self, obj);
 
-	if (!strncasecmp(RSTRING(format)->ptr, "intel", 5))
+	if (!strncasecmp(RSTRING_PTR(format), "intel", 5))
 		obj->format = FORMAT_INTEL;
-	else if (!strncasecmp(RSTRING(format)->ptr, "att", 3))
+	else if (!strncasecmp(RSTRING_PTR(format), "att", 3))
 		obj->format = FORMAT_ATT;
 	else
 		rb_raise(rb_eArgError, "Invalid output format (must be intel or att)");
diff -buprN -x CYGWIN-PATCHES -x aclocal.m4~ -x aclocal.m4t -x autom4te.cache -x config.cache -x config.guess -x config.log -x config.status -x config.sub -x '*SlackBuild*' -x '*.egg-info' -x '*.dll' -x '*.exe' -x '*.o' -x '*.gch' -x '*.gem' -x .gitignore -x '*.jpg' -x '*.png' -x '*.qm' -x '*.svgz' -x '*.tif' -x '*.class' -x '*.jlc' -x '*.pyc' -x '*.pyo' -x '*.mo' -x '*.gmo' -x '*.orig' -x '*.rej' -x '*.spec' -x '*.temp' -x '*~' -x '*.stackdump' -x x86_64-pc-cygwin -x aclocal.m4 -x configure -x config.h -x '*.h.in' -x COPYING -x INSTALL -x ansi2knr.c -x ar-lib -x config-ml.in -x elisp-comp -x mdate-sh -x mkinstalldirs -x py-compile -x symlink-tree -x test-driver -x texinfo.tex -x ylwrap -x Makefile.in -x GNUmakefile.in -x makefile.in -x libtool.m4 -x ltoptions.m4 -x ltsugar.m4 -x ltversion.m4 -x lt~obsolete.m4 -x ltmain.sh -x compile -x depcomp -x install-sh -x missing -x omf.make -x xmldocs.make -x gnome-doc-utils.make -x gnome-doc-utils.m4 -x mate-doc-utils.make -x mate-doc-utils.m4 -x Makefile origsrc/libdasm-1.5/rbdasm/extconf.rb src/libdasm-1.5/rbdasm/extconf.rb
--- origsrc/libdasm-1.5/rbdasm/extconf.rb	2006-01-11 14:01:53.000000000 +0900
+++ src/libdasm-1.5/rbdasm/extconf.rb	2018-04-26 12:32:19.843000000 +0900
@@ -1,2 +1,4 @@
 require 'mkmf'
+dir_config('dasm')
+have_library('dasm')
 create_makefile('dasm')
